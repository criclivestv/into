<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shaka Player</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/controls.min.css">
<style>
body, html { margin:0; padding:0; background:#000; height:100%; width:100%; display:flex; justify-content:center; align-items:center;}
#player-container { width:100%; max-width:1280px; aspect-ratio:16/9; position:relative; background:#000;}
video.shaka-video { width:100%; height:100%; object-fit:contain; background:#000;}
.shaka-controls-container { z-index:9999 !important; background:transparent !important;}
.overlay-logo, .overlay-text { position:absolute; z-index:50; pointer-events:none; display:none; color:#fff; font-weight:600;}
.overlay-logo { mix-blend-mode:normal;}
.overlay-text { font-size:18px; opacity:0.75;}
</style>
</head>
<body>
<div id="player-container">
  <video id="video" autoplay playsinline class="shaka-video"></video>
  <div class="shaka-controls-container"></div>
  <img id="overlayLogo" class="overlay-logo">
  <div id="overlayText" class="overlay-text"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/shaka-player.ui.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async()=>{
  const video = document.getElementById('video');
  const container = document.getElementById('player-container');
  const overlayLogo = document.getElementById('overlayLogo');
  const overlayText = document.getElementById('overlayText');

  // Initialize Shaka Player
  const player = new shaka.Player(video);
  player.addEventListener('error', e=>console.error('Shaka error', e.detail||e));

  const ui = new shaka.ui.Overlay(player, container, video);
  ui.configure({
    controlPanelElements:['play_pause','mute','volume','spacer','settings','quality','playback_rate','picture_in_picture','fullscreen'],
    settingsMenuElements:['quality','playback_rate']
  });
  player.configure({abr:{enabled:true}});

  // Get query params
  const params = new URLSearchParams(window.location.search);
  const url = params.get('url');
  const logo = params.get('logo');
  const logoPos = params.get('logoPos') || 'top-left';
  const logoSize = params.get('logoSize') || '120';
  const wm = params.get('wm');

  if(url){
    try{
      await player.load(decodeURIComponent(url));
      console.log('✅ Video loaded');
    }catch(e){console.error('❌ Error loading', e);}
  }

  // Overlay functions
  if(logo){
    overlayLogo.src = decodeURIComponent(logo);
    overlayLogo.style.display='block';
    overlayLogo.style.width=logoSize+'px';
    overlayLogo.style.height='auto';
    overlayLogo.style.top=''; overlayLogo.style.left=''; overlayLogo.style.right=''; overlayLogo.style.bottom=''; overlayLogo.style.transform='';
    switch(logoPos){
      case 'top-left': overlayLogo.style.top='10px'; overlayLogo.style.left='10px'; break;
      case 'top-right': overlayLogo.style.top='10px'; overlayLogo.style.right='10px'; break;
      case 'bottom-left': overlayLogo.style.bottom='10px'; overlayLogo.style.left='10px'; break;
      case 'bottom-right': overlayLogo.style.bottom='10px'; overlayLogo.style.right='10px'; break;
      case 'center': overlayLogo.style.top='50%'; overlayLogo.style.left='50%'; overlayLogo.style.transform='translate(-50%,-50%)'; break;
    }
  }

  if(wm){
    overlayText.textContent = decodeURIComponent(wm);
    overlayText.style.display='block';
    overlayText.style.top='10px';
    overlayText.style.left='10px';
  }
});
</script>
</body>
</html>
