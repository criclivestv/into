<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shaka Player â€” Full Player</title>

<!-- Shaka Player UI CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/controls.min.css">

<style>
html, body {
  margin:0; padding:0;
  height:100%; width:100%;
  background:#000; display:flex; justify-content:center; align-items:center;
  font-family:Arial, sans-serif;
}

#player-container {
  width:90%; max-width:1280px;
  aspect-ratio:16/9;
  position:relative; background:#000; border-radius:8px; overflow:hidden;
}

video.shaka-video {
  width:100%; height:100%;
  object-fit:contain;
  background:#000;
}

.shaka-controls-container {
  z-index:9999 !important;
  background:transparent !important;
}

.overlay-logo, .overlay-text {
  position:absolute; pointer-events:none; z-index:50; display:none;
  color:#fff; font-weight:600;
}

.overlay-logo { mix-blend-mode:normal; }
.overlay-text { font-size:18px; opacity:0.7; }
</style>
</head>
<body>

<div id="player-container">
  <video id="video" autoplay playsinline class="shaka-video"></video>
  <div class="shaka-controls-container"></div>
  <img id="overlayLogo" class="overlay-logo" alt="logo"/>
  <div id="overlayText" class="overlay-text"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/shaka-player.ui.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const video = document.getElementById('video');
  const container = document.getElementById('player-container');
  const overlayLogo = document.getElementById('overlayLogo');
  const overlayText = document.getElementById('overlayText');

  // Initialize Shaka Player
  const player = new shaka.Player(video);
  player.addEventListener('error', e => console.error('Shaka error', e.detail || e));

  const ui = new shaka.ui.Overlay(player, container, video);
  ui.configure({
    controlPanelElements: ['play_pause','mute','volume','spacer','settings','quality','playback_rate','picture_in_picture','fullscreen'],
    settingsMenuElements: ['quality','playback_rate']
  });
  player.configure({ abr: { enabled:true } });

  // Read query params
  const params = new URLSearchParams(location.search);
  const manifest = params.get('url');
  const logoUrl = params.get('logo');
  const logoPos = params.get('logoPos') || 'top-left';
  const logoSize = parseInt(params.get('logoSize')) || 120;
  const logoOpacity = parseInt(params.get('logoOpacity')) || 85;
  const wmTextVal = params.get('wmText') ? decodeURIComponent(params.get('wmText')) : '';
  const wmOn = params.get('wmOn')==='1';

  async function loadStream(url){
    try { await player.load(url); console.log('Stream loaded:', url); }
    catch(e){ console.error('Error loading stream:', e); alert('Error loading stream'); }
  }

  function placeOverlay(){
    // Logo
    if(logoUrl){
      overlayLogo.src = logoUrl;
      overlayLogo.style.display = 'block';
      overlayLogo.style.opacity = logoOpacity/100;
      overlayLogo.style.width = logoSize+'px'; overlayLogo.style.height='auto';
      overlayLogo.style.top=''; overlayLogo.style.left=''; overlayLogo.style.right=''; overlayLogo.style.bottom=''; overlayLogo.style.transform='';
      switch(logoPos){
        case 'top-left': overlayLogo.style.top='10px'; overlayLogo.style.left='10px'; break;
        case 'top-right': overlayLogo.style.top='10px'; overlayLogo.style.right='10px'; break;
        case 'bottom-left': overlayLogo.style.bottom='10px'; overlayLogo.style.left='10px'; break;
        case 'bottom-right': overlayLogo.style.bottom='10px'; overlayLogo.style.right='10px'; break;
        case 'center': overlayLogo.style.top='50%'; overlayLogo.style.left='50%'; overlayLogo.style.transform='translate(-50%,-50%)'; break;
      }
    }

    // Watermark
    if(wmTextVal && wmOn){
      overlayText.textContent = wmTextVal;
      overlayText.style.display='block';
      overlayText.style.top='10px';
      overlayText.style.left='10px';
    }
  }

  if(manifest) loadStream(manifest);
  placeOverlay();
});
</script>

</body>
</html>
